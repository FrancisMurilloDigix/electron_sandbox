defmodule SecpExTest do
  use ExUnit.Case

  test "libsecp256k1 should be working" do
    assert {28,
     38938543279057362855969661240129897219713373336787331739561340553100525404231,
     23772455091703794797226342343520955590158385983376086035257995824653222457926} == Blockchain.Transaction.Signature.sign_hash(<<2::256>>, <<1::256>>)

    assert Blockchain.Transaction.Signature.sign_hash(<<5::256>>, <<1::256>>) == {27,
     74927840775756275467012999236208995857356645681540064312847180029125478834483,
     56037731387691402801139111075060162264934372456622294904359821823785637523849}

    data = "ec098504a817c800825208943535353535353535353535353535353535353535880de0b6b3a764000080018080" |> BitHelper.from_hex
    hash = data |> ExthCrypto.Hash.Keccak.kec()
    private_key = "4646464646464646464646464646464646464646464646464646464646464646" |> BitHelper.from_hex
    assert Blockchain.Transaction.Signature.sign_hash(hash, private_key, 1) == { 37, 18515461264373351373200002665853028612451056578545711640558177340181847433846, 46948507304638947509940763649030358759909902576025900602547168820602576006531 }
  end

  test "[rohit] another test added (based on Tracker entry)" do
    tx = %Blockchain.Transaction{
      data: <<179, 3, 41, 229, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 179, 53, 255, 136, 3, 164, 103, 7, 93, 217, 205, 66, 182, 90, 120, 117, 249, 44, 100, 27, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 200, 223, 206, 197, 58, 177, 16, 42, 56, 232, 249, 107, 232, 235, 163, 127, 197, 52, 12, 153>>,
      to: <<232, 62, 170, 97, 52, 171, 203, 136, 110, 250, 77, 66, 77, 9, 124, 40, 223, 205, 199, 36>>,
      init: <<>>,
      value: 0,
      gas_limit: 200000,
      gas_price: 10000000000,
      nonce: 0
    }

    signed_tx =
      tx
      |> Blockchain.Transaction.Signature.sign_transaction(<<199, 171, 134, 109, 45, 46, 96, 10, 173, 26, 83, 16, 204, 12, 122, 193, 107, 202, 85, 52, 47, 249, 139, 54, 87, 20, 177, 63, 254, 246, 202, 30>>)

    assert %{
      r: 68262044552050674873339673713038097488344450144808287139785852188390132866620,
      s: 7306457232770890327263144714213405523838282987408813007616809448749158333547,
      v: 27
    } == Map.take(signed_tx, [:r, :s, :v])
  end
end
